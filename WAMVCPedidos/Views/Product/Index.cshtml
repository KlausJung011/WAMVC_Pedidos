@using Microsoft.AspNetCore.Identity
@model WAMVCPedidos.Models.ViewModels.ProductIndexViewModel

@{
    ViewData["Title"] = "Productos";
    var f = Model.Filter;
}

<h1>Index</h1>

<div class="container-fluid">
    <div class="row">
        <div class="col-12">

            <div class="card shadow-lg border-0 mb-3">
                <div class="card-header bg-dark text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-filter me-2"></i>Filtros
                    </h5>
                </div>
                <div class="card-body">
                    <form method="get" class="row g-3 align-items-end">
                        <div class="col-md-3">
                            <label class="form-label">Buscar (nombre o descripción)</label>
                            <input name="Search" value="@f.Search" class="form-control" placeholder="Ej: taza" />
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Categoría</label>
                            <select name="Category" class="form-select">
                                <option value="">(Todas)</option>
                                @foreach (var c in Model.Categories)
                                {
                                    <option value="@c.Value" selected="@(c.Value == f.Category)">@c.Text</option>
                                }
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label class="form-label">Precio mín.</label>
                            <input name="MinPrice" value="@(f.MinPrice?.ToString())" class="form-control" type="number" step="0.01" min="0" />
                        </div>
                        <div class="col-md-2">
                            <label class="form-label">Precio máx.</label>
                            <input name="MaxPrice" value="@(f.MaxPrice?.ToString())" class="form-control" type="number" step="0.01" min="0" />
                        </div>
                        <div class="col-md-2">
                            <label class="form-label">Por página</label>
                            <div class="input-group">
                                <input name="PageSize" value="@f.PageSize" class="form-control" type="number" min="1" max="200" />
                                <button class="btn btn-outline-secondary" type="submit">Aplicar</button>
                            </div>
                        </div>

                        <input type="hidden" name="PageNumber" value="1" />
                    </form>
                </div>
            </div>

            <div class="card shadow-lg border-0">
                <div class="card-header text-white bg-dark d-flex justify-content-between align-items-center">
                    <h2 class="mb-0">
                        <i class="fas fa-boxes me-2"></i>Gestión de Productos
                    </h2>
                    @if (User.IsInRole("admin") || User.IsInRole("empleado"))
                    {
                        <a asp-action="Create" class="btn btn-outline-light btn-lg">
                            <i class="fas fa-plus me-1"></i>Nuevo Producto
                        </a>
                    }
                </div>
                <div class="card-body p-0">
                    @if (Model.Items != null && Model.Items.Any())
                    {
                        <div class="table-responsive">
                            <table class="table table-hover table-striped mb-0 modern-table">
                                <thead class="table-dark">
                                    <tr>
                                        <th class="px-4 py-3">
                                            <i class="fas fa-tag me-2"></i>Nombre
                                        </th>
                                        <th class="px-4 py-3">
                                            <i class="fas fa-align-left me-2"></i>Descripción
                                        </th>
                                        <th class="px-4 py-3">
                                            <i class="fas fa-dollar-sign me-2"></i>Precio
                                        </th>
                                        <th class="px-4 py-3">
                                            <i class="fas fa-box me-2"></i>Stock
                                        </th>
                                        <th class="px-4 py-3">
                                            <i class="fas fa-tags me-2"></i>Categoría
                                        </th>
                                        <th class="px-4 py-3 text-center">
                                            <i class="fas fa-cogs me-2"></i>Acciones
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var item in Model.Items)
                                    {
                                        <tr>
                                            <td class="px-4 py-3">
                                                <strong>@item.Nombre</strong>
                                            </td>
                                            <td class="px-4 py-3">
                                                @item.Descripcion
                                            </td>
                                            <td class="px-4 py-3">
                                                <span class="badge bg-info text-dark fs-6 px-3 py-2">
                                                    @item.Precio.ToString("C")
                                                </span>
                                            </td>
                                            <td class="px-4 py-3">
                                                <span class="badge bg-secondary fs-6 px-3 py-2">
                                                    @item.Stock
                                                </span>
                                            </td>
                                            <td class="px-4 py-3">
                                                @item.Categoria
                                            </td>
                                            <td class="px-4 py-3 text-center">
                                                <div class="btn-group" role="group">
                                                    @if (User.IsInRole("admin") || User.IsInRole("empleado"))
                                                    {
                                                        <a asp-action="Edit" asp-route-id="@item.Id" class="btn btn-sm btn-outline-primary" title="Editar">
                                                            <i class="fas fa-edit"></i>
                                                        </a>
                                                        <a asp-action="Delete" asp-route-id="@item.Id" class="btn btn-sm btn-outline-danger" title="Eliminar">
                                                            <i class="fas fa-trash"></i>
                                                        </a>
                                                    }
                                                    <a asp-action="Details" asp-route-id="@item.Id" class="btn btn-sm btn-outline-info" title="Detalles">
                                                        <i class="fas fa-eye"></i>
                                                    </a>
                                                </div>
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>

                        <div class="p-3 d-flex justify-content-between align-items-center">
                            <div>
                                Mostrando
                                <strong>@Model.Items.Count()</strong> de
                                <strong>@Model.TotalCount</strong> registros.
                            </div>
                            <nav aria-label="Paginación">
                                <ul class="pagination mb-0">
                                    @{
                                        var prevDisabled = Model.Filter.PageNumber <= 1 ? "disabled" : "";
                                        var nextDisabled = Model.Filter.PageNumber >= Model.TotalPages ? "disabled" : "";
                                    }
                                    <li class="page-item @prevDisabled">
                                        <a class="page-link"
                                           asp-action="Index"
                                           asp-route-Search="@f.Search"
                                           asp-route-Category="@f.Category"
                                           asp-route-MinPrice="@f.MinPrice"
                                           asp-route-MaxPrice="@f.MaxPrice"
                                           asp-route-PageSize="@f.PageSize"
                                           asp-route-PageNumber="@(f.PageNumber - 1)">«</a>
                                    </li>

                                    @for (int i = 1; i <= Model.TotalPages; i++)
                                    {
                                        <li class="page-item @(i == f.PageNumber ? "active" : "")">
                                            <a class="page-link"
                                               asp-action="Index"
                                               asp-route-Search="@f.Search"
                                               asp-route-Category="@f.Category"
                                               asp-route-MinPrice="@f.MinPrice"
                                               asp-route-MaxPrice="@f.MaxPrice"
                                               asp-route-PageSize="@f.PageSize"
                                               asp-route-PageNumber="@i">@i</a>
                                        </li>
                                    }

                                    <li class="page-item @nextDisabled">
                                        <a class="page-link"
                                           asp-action="Index"
                                           asp-route-Search="@f.Search"
                                           asp-route-Category="@f.Category"
                                           asp-route-MinPrice="@f.MinPrice"
                                           asp-route-MaxPrice="@f.MaxPrice"
                                           asp-route-PageSize="@f.PageSize"
                                           asp-route-PageNumber="@(f.PageNumber + 1)">»</a>
                                    </li>
                                </ul>
                            </nav>
                        </div>
                    }
                    else
                    {
                        <div class="text-center py-5">
                            <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
                            <h4 class="text-muted">No hay productos registrados</h4>
                            <p class="text-muted">Comienza creando tu primer producto</p>
                            @if (User.IsInRole("admin") || User.IsInRole("empleado"))
                            {
                                <a asp-action="Create" class="btn btn-primary btn-lg">
                                    <i class="fas fa-plus me-1"></i>Crear Primer Producto
                                </a>
                            }
                        </div>
                    }
                </div>
            </div>

        </div>
    </div>
</div>